## 阿里巴巴coding面试题

#### 一个防爬虫的运维系统：
1. 一分钟内访问超过500次，加入黑名单
2. 一个小时内访问超过15000次，加入黑名单
3. 一个黑名单的用户一分钟内访问不超过500次或者一个小时内访问不超过15000次，解除黑名单


#### 解决思路
单线程：
读取一个访问记录，其访问记录的数据形式为"ip-UnixTime"，例如"192.168.1.90-1534493633441".
针对记录的存储数据结构为Hashmap。开辟两个hashmap的对象，一个存储正常访问的ip记录normalmap，一个存储黑名单的ip记录blackmap。hashmap存储的数据形式为{"ip"，"startTimeMinute-countMinute-startTimeHour-countHour"}，即分开统计每分钟和每小时的访问数。
Monitor顺序读取每一条记录，处理一个记录的流程如下：
1. 如果该ip首次访问，则添加到normalmap.
2. 如果该ip在normalmap内且一分钟内未超过500次访问，则继续留在normalmap，更新normalmap中该ip的"startTimeMinute"和"countMinute".
3. 如果该ip在normalmap内且一分钟超过500次访问，则将该ip移到blackmap中，并重新计算该ip的一分钟内访问次数
4. 如果该ip在blackmap内且一分钟内未超过500次访问，则将该ip移到normalmap中，并重新计算该ip的一分钟内访问次数

方案缺点：
1. 将时间离散成一个个以一分钟为基本单位的时间片，未考虑时间片之间连续的访问记录，初步设想应该可以使用类似TCP的滑动窗口办法
2. 没有并发地读取访问记录，预想方案希望可以通过并发地访问记录，并发地对hashmap进行读写，能力有限，尚未完成
3. 预计设置一个计时器，每隔一秒中扫描两个hashmap的内容，在遍历中使用了迭代器，但是迭代器没有实现读写锁，能力有限，还没有寻求解决的办法


